<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sors avec moi stp</title>
  <style>
    html, body { height: 100%; margin: 0; overflow: hidden; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background-image: url("background_ouinon.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.6s ease, filter 0.6s ease;
    }

    body.bg-angry {
      background-image: url("background_sad.png");
      filter: saturate(1.3) contrast(1.1);
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
    }

    .card {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.92);
      padding: 28px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
      max-width: 720px;
      width: calc(100% - 48px);
      text-align: center;
      z-index: 5;
    }

    .card-inner {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .card-content {
      flex: 1;
      min-width: 0;
    }

    .couic-side {
      width: 56px;
      height: 56px;
      object-fit: contain;
      flex: 0 0 auto;
    }

    /* Textes qui pop autour de la card */
    .floating-text {
      position: absolute;
      max-width: 220px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.92);
      box-shadow: 0 14px 28px rgba(0,0,0,0.18);
      font-weight: 800;
      z-index: 8;
      pointer-events: none;
      transform: rotate(var(--rot, 0deg));
    }

    @media (max-width: 520px) {
      .couic-side { width: 44px; height: 44px; }
    }

    .button-row {
      margin-top: 22px;
      display: flex;
      gap: 16px;
      justify-content: center;
      position: relative;
      z-index: 6;
    }

    h1 { margin: 0 0 12px; }
    p { margin: 0; }

    .hint {
      margin-top: 14px;
      font-weight: 600;
      min-height: 1.5em; /* Ã©vite que Ã§a saute en hauteur */
    }

    button {
      border: none;
      border-radius: 14px;
      padding: 14px 22px;
      font-size: 18px;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 24px rgba(0,0,0,0.18);
    }

    #yesBtn {
      background: #2ecc71;
      color: white;
      transform: scale(1);
      transform-origin: center;
      transition: transform 0.08s linear;
    }

    #noBtn {
      background: #e74c3c;
      color: white;
    }

    /* Quand il s'Ã©chappe, il devient positionnÃ© librement */
    #noBtn.escaped {
      position: absolute;
      z-index: 30;
    }

    .playground {
      position: fixed;
      inset: 0;
      z-index: 10;
    }

    .yesClone {
      position: absolute;
      background: #2ecc71;
      color: white;
      z-index: 15;
      opacity: 0.98;
    }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <div class="playground" id="playground">
    <div class="card">
      <div class="card-inner">
        <img class="couic-side" src="couic.png" alt="couic" />

        <div class="card-content">
          <h1 id="question">Veux-tu Ãªtre ma valentine ?</h1>
          <div class="hint" id="hint">Attention au couic...</div>
          <div class="button-row" id="buttonRow">
            <button id="yesBtn" type="button">Oui</button>
            <button id="noBtn" type="button">Non</button>
          </div>
        </div>

        <img class="couic-side" src="couic.png" alt="couic" />
      </div>
    </div>
  </div>

  <script>
    const nonTexts = [
      "Pardon?",
      "BB EST-CE DONC UNE BLAGUE",
      "PrÃ©paration du couic",
      "Je sais oÃ¹ t'habites",
    ];

    const floatingTexts = [
      "Bb ?",
      "Ã‡a fait beaucoup de non lÃ ",
      "Bb je suis un forceur je me laisserai pas faire",
      "Bb t'as vraiment cru que tu pourrais continuer Ã  me refuser??",
      "Julia Simone Ginette DaniÃ¨le Weber... ðŸ˜ "
    ];

    let noClicks = 0;
    let yesScale = 1;

    const playground = document.getElementById("playground");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const hint = document.getElementById("hint");
    const buttonRow = document.getElementById("buttonRow");
    let hasEscaped = false;

    function rand(min, max) {
      return Math.random() * (max - min) + min;
    }

    function spawnFloatingText(msg) {
      const card = document.querySelector('.card');
      const rect = card.getBoundingClientRect();

      // Zone autour de la card (anneau)
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const angle = rand(0, Math.PI * 2);
      const radius = rand(Math.max(rect.width, rect.height) * 0.55, Math.max(rect.width, rect.height) * 0.95);

      let x = cx + Math.cos(angle) * radius;
      let y = cy + Math.sin(angle) * radius;

      const el = document.createElement('div');
      el.className = 'floating-text';
      el.textContent = msg;
      el.style.setProperty('--rot', (rand(-10, 10)).toFixed(1) + 'deg');

      // On l'ajoute d'abord pour mesurer sa taille rÃ©elle
      el.style.left = '0px';
      el.style.top = '0px';
      playground.appendChild(el);

      const padding = 14;
      const ew = el.offsetWidth;
      const eh = el.offsetHeight;

      // Clamp dans l'Ã©cran en tenant compte de la taille de la bulle
      x = Math.min(window.innerWidth - ew - padding, Math.max(padding, x));
      y = Math.min(window.innerHeight - eh - padding, Math.max(padding, y));

      el.style.left = x + 'px';
      el.style.top = y + 'px';

      // Petite disparition douce au bout de quelques secondes
      setTimeout(() => {
        el.style.transition = 'opacity 0.6s ease';
        el.style.opacity = '0';
        setTimeout(() => el.remove(), 650);
      }, 3500);
    }

    yesBtn.addEventListener("click", () => {
      // direct=1 si elle clique Oui tout de suite (avant tout "Non")
      const direct = (noClicks === 0) ? "1" : "0";
      window.location.href = `oui.html?direct=${direct}`;
    });

    function moveNoRandom() {
      noBtn.classList.add("escaped");
      const padding = 12;
      const rect = noBtn.getBoundingClientRect();
      const w = rect.width;
      const h = rect.height;

      const maxX = window.innerWidth - w - padding;
      const maxY = window.innerHeight - h - padding;

      const x = Math.max(padding, Math.floor(Math.random() * maxX));
      const y = Math.max(padding, Math.floor(Math.random() * maxY));

      noBtn.style.left = x + "px";
      noBtn.style.top = y + "px";
    }

    function growYes() {
      // Croissance sans limite (Ã§a peut dÃ©passer l'Ã©cran)
      yesScale = yesScale * 1.25;
      yesBtn.style.transform = `scale(${yesScale})`;
    }

    function fillWithYesButtons() {
      // On cache Non pour terminer le gag
      noBtn.style.display = "none";

      const cloneW = 120;
      const cloneH = 56;
      const gap = 8;

      const cols = Math.ceil((window.innerWidth + gap) / (cloneW + gap));
      const rows = Math.ceil((window.innerHeight + gap) / (cloneH + gap));

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "yesClone";
          b.textContent = "Oui";

          const x = c * (cloneW + gap);
          const y = r * (cloneH + gap);

          b.style.left = x + "px";
          b.style.top = y + "px";
          b.style.width = cloneW + "px";
          b.style.height = cloneH + "px";

          b.addEventListener("click", () => {
            window.location.href = "oui.html?direct=0";
          });

          playground.appendChild(b);
        }
      }
    }

    noBtn.addEventListener("click", () => {
      const idx = Math.min(noClicks, nonTexts.length - 1);
      hint.textContent = nonTexts[idx];

      // Ã€ partir du 5e clic sur Non, on fait apparaÃ®tre des textes autour de la card
      if (noClicks >= 4) {
        const tIdx = Math.min(noClicks - 4, floatingTexts.length - 1);
        spawnFloatingText(floatingTexts[tIdx]);
      }

      noClicks++;

      // Ã€ partir du 3e clic sur Non, on change le background
      if (noClicks >= 3) {
        document.body.classList.add("bg-angry");
      }

      growYes();

      // Ã€ partir du 1er clic, le bouton Non s'Ã©chappe
      if (!hasEscaped) {
        hasEscaped = true;
        buttonRow.removeChild(noBtn);
        playground.appendChild(noBtn);
        noBtn.classList.add("escaped");
        moveNoRandom();
      } else {
        moveNoRandom();
      }

      if (noClicks >= 10) {
        hint.textContent = "Bb tu n'as donc pas le choix";
        fillWithYesButtons();
      }
    });

    window.addEventListener("resize", () => {
      if (noBtn.style.display !== "none") moveNoRandom();
    });
  </script>
</body>
</html>
